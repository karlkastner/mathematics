% Tue  3 May 16:13:01 CEST 2016
% inverse of a 3x3 matrix
function Ai = inv3x3(A)

%a = A(1,1,:);
%b = A(1,1,:);
%c = A(1,1,:);
%d = A(1,1,:);
%e = A(1,1,:);
%f = A(1,1,:);

% A = [ a, b, c]
%     [ d, e, f]
%     [ g, h, i]

% det = [a.*e.*i - a.*f.*h - b.*d.*i + b.*f.*g + c.*d.*h - c.*e.*g];
% iA = [e.*i - f.*h, c.*h - b.*i, b.*f - c.*e;
%      f.*g - d.*i, a.*i - c.*g, c.*d - a.*f;
%     d.*h - e.*g, b.*g - a.*h, a.*e - b.*d];
	det = det3x3(A);
Ai = [A(2,2,:).*A(3,3,:) - A(2,3,:).*A(3,2,:), A(1,3,:).*A(3,2,:) - A(1,2,:).*A(3,3,:), A(1,2,:).*A(2,3,:) - A(1,3,:).*A(2,2,:);
      A(2,3,:).*A(3,1,:) - A(2,1,:).*A(3,3,:), A(1,1,:).*A(3,3,:) - A(1,3,:).*A(3,1,:), A(1,3,:).*A(2,1,:) - A(1,1,:).*A(2,3,:);
      A(2,1,:).*A(3,2,:) - A(2,2,:).*A(3,1,:), A(1,2,:).*A(3,1,:) - A(1,1,:).*A(3,2,:), A(1,1,:).*A(2,2,:) - A(1,2,:).*A(2,1,:)];
% normalise
Ai = bsxfun(@times,1./det,Ai);

end

